<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>INDEX</title>
    <link rel="stylesheet" th:href="@{/css/user/addDietDetail.css}">
    <link rel="stylesheet" th:href="@{/css/user/local.css}">
    <script th:src="@{/bootstrap/js/jquery-3.3.1.js}"></script>
    <script th:src="@{/bootstrap/js/bootstrap.js}"></script>
    <script th:src="@{/js/user/addDietDetail.js}"></script>

    <style>
        .style_foodName{
            font-size: 13px;
        }
    </style>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var contextPath = [[${#request.getContextPath()}]]; //获取当前应用路径
        /*]]>*/
    </script>

    <script th:inline="javascript">

        function focusFood(t){
            // alert($(t).html())
            alert($(t).children('.selectPre').html())
        }

        <!-- 分页 -->
        function page_food(currentPage){
            $.ajax({
                type:"post",
                url:contextPath+"/user/foodPage",
                data: {currentPage: currentPage},
                success:function (resultData) {
                    console.log("foods",resultData)
                    console.log("1",getFoodType());
                    var foodType = getFoodType();

                    var foodClass = ['谷','豆','蔬','果','肉',' 乳','蛋','鱼','油','另'];
                    var str = '';
                    for(var i = 0; i < resultData.foods.length; i++){
                        var typeName = '另';
                        var thisFoodClass = 'food-type-';
                        for(var j = 0; j < foodType.length; j++) {
                            if(resultData.foods[i].typeId === foodType[j].number){
                                typeName = foodType[j].typeName;
                                break;
                            }
                        }
                        for(var j = 0; j < foodClass.length; j++){
                            if(typeName === foodClass[j]){
                                thisFoodClass = thisFoodClass + (j+1);
                            }
                        }

                        str+='<div class="food-search-item">\n' +
                            '                            <div onclick="focusFood(this)" draggable="true">\n' +
                            '                                <span class="pull-right selectPre"><strong>'+resultData.foods[i].energy.toFixed(2)+'</strong> Kcal/100g</span>\n' +
                            '                                <div class="pull-right selectNext" style="display: none">\n' +
                                                                '<span class="pull-left" style="color:#919191">选入：</span>\n' +
                                                                '<button class="btn-add-food-0" >早</button>\n' +
                                                                '<button class="btn-add-food-1" >午</button>\n' +
                                                                '<button class="btn-add-food-2" >晚</button>\n' +
                                                             '</div>'+
                            '                                <div class="food-type '+thisFoodClass+'"></div>\n' +
                            '                                <span class="style_foodName">'+resultData.foods[i].foodName+'</span>\n' +
                            '                            </div>\n' +
                            '                        </div>';
                    }
                    $('#div_foodList').html(str);
                    if(resultData.curPage <= 1){
                        $('#prePage').css('display','none');
                    }else{
                        $('#prePage').css('display','block');
                    }
                    if(resultData.curPage >= totalPage){
                        $('#nextPage').css('display','none');
                    }else{
                        $('#nextPage').css('display','block');
                    }
                    $('#currentPage').html(resultData.curPage);
                    $('#totalPage').html(resultData.totalPage);
                },
                error:function () {
                    alert("服务器请求失败");
                }
            });
        }

        $(function () {
            // console.log("1",getFoodType());

            page_food(1);

            $('#prePage').click(function () {
                page_food($('#currentPage').text() - 1);
            });

            $('#nextPage').click(function () {
                var curPage = $('#currentPage').text();
                page_food(parseInt(curPage) + 1);
            });

        });

        window.addEventListener("scroll",function(e){
            //变量t就是滚动条滚动时，到顶部的距离
            // var t = document.documentElement.scrollTop||document.body.scrollTop;
            var h = getScrollInfo().scrollTop - 340;
            if (h < 0) {
                h = 0
            }
            $('#foodToolMT').css('marginTop',h);
        });


    </script>


</head>
<body class="indexBody">
<div id="body">
    <!--nav-->
    <div th:replace="/html/top :: html"></div>

    <div class="EditDiet container">

        <!--<input type="hidden" name="currentPage" id="currentPage" th:value="${foods.pageNum}">-->

        <h2>
            添加食谱
            <span style="font-size: 18px">
                New Diet Detail
            </span>
        </h2>
        <hr/>

        <!--基础设置 -->
        <div class="row">
            <div class="col-lg-5 col-sm-4 ">
                <div class="hr-panel">
                    <div class="hr-panel-title">
                        食谱基本信息
                    </div>
                    <div class="hr-panel-body" style="padding: 10px">

                        <div class="row">
                            <div class="col-xs-6 col-md-12" style="margin-bottom: 10px">
                                <label for="dietTitle">
                                    食谱名称
                                </label>
                                <input id="dietTitle" type="text" class="form-control" >
                            </div>
                            <div class="col-md-6 col-xs-6" style="margin-bottom: 10px">
                                <label for="targetEnergy">
                                    目标能量 <span class="hidden-sm hidden-xs">(Kcal)</span>
                                </label>
                                <!--function -->
                                <input id="targetEnergy" type="number" class="form-control" onkeyup="minNumber(this)"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7 col-sm-8">
                <div class="hr-panel">
                    <div class="hr-panel-title">
                        供能比例
                    </div>
                    <div class="hr-panel-body" style="padding: 10px">
                        <div class="row">
                            <div class="col-sm-6">
                                <label>
                                    三大营养素能量比例
                                </label>

                                <table class="table table-bordered table-responsive" style="margin-bottom: 16px;">
                                    <thead>
                                    <tr>
                                        <td>
                                            碳水化合物
                                        </td>
                                        <td>
                                            蛋白质
                                        </td>
                                        <td>
                                            脂肪
                                        </td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td> <input type="number" class="form-control input-sm" value="50"/></td>
                                        <td> <input type="number" class="form-control input-sm" value="25"/></td>
                                        <td> <input type="number" class="form-control input-sm" value="25"/></td>
                                    </tr>
                                    </tbody>
                                </table>

                            </div>
                            <div class="col-sm-6">
                                <label>
                                    三餐能量比例
                                </label>

                                <table class="table table-bordered table-responsive" style="margin-bottom: 16px;">
                                    <thead>
                                    <tr>
                                        <td>
                                            早餐
                                        </td>
                                        <td>
                                            午餐
                                        </td>
                                        <td>
                                            晚餐
                                        </td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td> <input type="number" class="form-control input-sm" value="3"/></td>
                                        <td> <input type="number" class="form-control input-sm" value="4"/></td>
                                        <td> <input type="number" class="form-control input-sm" value="3"/></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br/>

        <!--详细设置-->
        <div class="row">
            <div class="col-md-4 col-lg-3 col-sm-4">
                <!--食物查询-->
                <div id="foodToolMT" class="hr-panel" style="transition:margin-top 0.6s cubic-bezier(0, 1.12, 1, 1.06);">
                    <div class="hr-panel-title">
                        <div class="row">
                            <div class="col-md-4">
                                <strong style="line-height: 30px;text-align: right">
                                    食物名称
                                </strong>
                            </div>
                            <div class="col-md-8">
                                <input type="text" class="form-control input-sm" placeholder="名称关键字">
                            </div>
                            <div class="col-md-4" style="margin-top: 10px">
                                <strong style="line-height: 30px;text-align: right">
                                    单位能量
                                </strong>
                            </div>
                            <div class="col-md-8" style="margin-top: 10px">

                                <!--function 鼠标离开事件-->
                                <input type="text" placeholder="最小" class="form-control input-sm pull-left" style="max-width: 70px">

                                <input type="text" placeholder="最大" class="form-control input-sm pull-right" style="max-width: 70px">
                            </div>
                            <div class="col-sm-12 box-row hor-ends" style="margin-top: 10px">

                                <!--后台 食物类型 数据 点击事件-->
                                <div class="food-type select-food-type">
                                    <span>谷</span>
                                </div>
                                <div class="food-type select-food-type">
                                    <span>豆</span>
                                </div>
                                <div class="food-type select-food-type">
                                    <span>蔬</span>
                                </div>
                                <div class="food-type select-food-type">
                                    <span>果</span>
                                </div>
                                <div class="food-type select-food-type">
                                    <span>肉</span>
                                </div>
                                <div class="food-type select-food-type">
                                    <span>乳</span>
                                </div>
                                <div class="food-type select-food-type">
                                    <span>蛋</span>
                                </div>
                                <div class="food-type select-food-type">
                                    <span>鱼</span>
                                </div>
                                <div class="food-type select-food-type">
                                    <span>油</span>
                                </div>
                                <div class="food-type select-food-type">
                                    <span>另</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="div_foodList" class="hr-panel-body" style="padding:10px 0;min-height: 260px;position: relative">
                        <!--食物 后台所有食物数据-->
                        <!--<div ms-repeat="foodList" class="food-search-item"-->
                             <!--ms-class="focusing-food:$index===focusingFood">-->
                            <!--<div ms-click="focusFood($index)" draggable="true">-->
                                <!---->
                                <!--<span class="pull-right" ms-if="$index!==focusingFood"><strong>{{Number(Number(el.Energy*100).toFixed(2))}}</strong> Kcal/100g</span>-->
                                <!--<div class="pull-right" ms-if="$index===focusingFood">-->
                                    <!--<span class="pull-left" style="color:#919191">选入：</span>-->
                                    <!--<button class="btn-add-food-0" ms-click="pushFood(0,$index)">早</button>-->
                                    <!--<button class="btn-add-food-1" ms-click="pushFood(1,$index)">午</button>-->
                                    <!--<button class="btn-add-food-2" ms-click="pushFood(2,$index)">晚</button>-->
                                <!--</div>-->
                                <!--<div class="food-type" ms-class="food-type-{{el.TypeID}}"></div>-->
                                <!--<span>{{el.Name}}</span>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="food-search-item" th:each="food,iterStat:${foods.list}">-->
                            <!--<div draggable="true">-->
                                <!--<span class="pull-right"><strong><span th:text="${#numbers.formatDecimal(food.energy,1,2)}"></span></strong> Kcal/100g</span>-->
                                <!--<div class="food-type food-type-1"></div>-->
                                <!--<span th:text="${food.foodName}"></span>-->
                            <!--</div>-->
                        <!--</div>-->

                        <!--<div class="food-search-item">-->
                            <!--<div draggable="true">-->
                                <!--<span class="pull-right"><strong>246</strong> Kcal/100g</span>-->
                                <!--<div class="food-type food-type-1"></div>-->
                                <!--<span>全麦面包</span>-->
                            <!--</div>-->
                        <!--</div>-->

                    </div>
                    <div class="hr-panel-footer food-search-pager">

                        <!--分页 -->
                        <div class="row">
                            <div class="col-sm-3">
                                <i id="prePage" class="icon iconfont icon-shangyiye"></i>
                            </div>
                            <div class="col-sm-6">
                                第<span id="currentPage"></span>/<span id="totalPage"></span>页
                            </div>
                            <div class="col-sm-3">
                                <i id="nextPage" class="icon iconfont icon-shangyiye1-copy"></i>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="col-lg-9 col-md-8 col-sm-8">
                <!--食谱食材列表-->
                <div class="hr-panel" ms-repeat="foods"
                     ms-class="panel-success:$index==0"
                     ms-class-2="panel-danger:$index==1"
                     ms-class-3="panel-info:$index==2"
                     style="margin-bottom: 20px">
                    <div class="hr-panel-title ">
                        <span ms-if="$index==0" class="text-success pull-left">早餐</span>
                        <span ms-if="$index==1" class="text-danger pull-left">午餐</span>
                        <span ms-if="$index==2" class="text-info pull-left">晚餐</span>

                        <!--<div class="box-row pull-left" style="width: 500px;margin-left: 20px">-->
                            <!--<div class="food-type select-food-type" style="display: block"-->
                                 <!--ms-class="food-type-{{el.TypeID}}:el.mealTotal[$outer.$index]>0"-->
                                 <!--ms-repeat="foodTypes"-->
                                 <!--ms-click="wantFoodType(el.TypeID,$outer.$index,this)">-->
                                <!--<span ms-if="el.mealTotal[$outer.$index]==0">-->
                                     <!--{{el.icon}}-->
                                <!--</span>-->
                            <!--</div>-->
                        <!--</div>-->

                        <!--<div class="pull-right" >-->
                            <!--<div class="food-type food-type-1"></div>-->
                            <!--已包含；-->
                            <!--<div class="food-type want-food-type">谷</div>-->
                            <!--已计划；-->
                            <!--<div class="food-type select-food-type">谷</div>-->
                            <!--未计划；-->
                        <!--</div>-->

                        <div class="clearfix"></div>


                    </div>
                    <div class="hr-panel-body" style="padding:10px">

                        <table class="table table-responsive table-bordered">
                            <thead>
                            <tr>
                                <td></td>
                                <td>食物</td>
                                <td>数量(g)</td>
                                <td>能量(kcal)</td>
                                <td>碳水化合物(g)</td>
                                <td>蛋白质(g)</td>
                                <td>脂肪(g)</td>
                                <!--<td>备注</td>-->
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>
                                    <!--点击事件-->
                                    <button class="btn btn-xs btn-default" ms-click="delFoodInput(el,$index,$outer.$index)">
                                        删
                                    </button>
                                </td>
                                <td>
                                    <div class="food-type"></div>
                                    {{al.Name}}
                                </td>
                                <td>
                                    <input type="number"
                                           ms-attr-id="foodWeightInput_{{$outer.$index}}_{{$index}}_eal"
                                           class="table-input "
                                           placeholder="输入重量"
                                           style="max-width: 70px"
                                           ms-on-keyup="sum($outer.$index,$index)"
                                           ms-on-change="sum($outer.$index,$index)"
                                           ms-duplex="al.Weight"
                                           min="0" onkeyup="minNumber(this)"/>
                                </td>
                                <td>
                                    <input type="number"
                                           ms-attr-id="foodWeightInput_{{$outer.$index}}_{{$index}}_eal"
                                           class="table-input "
                                           placeholder=""
                                           style="max-width: 70px"
                                           ms-on-keyup="sum($outer.$index,$index,'Energy')"
                                           ms-on-change="sum($outer.$index,$index,'Energy')"
                                           ms-duplex="al.totalEnergy"
                                           min="0" onkeyup="minNumber(this)"/>

                                </td>
                                <td>
                                    <input type="number"
                                           ms-attr-id="foodWeightInput_{{$outer.$index}}_{{$index}}_eal"
                                           class="table-input "
                                           placeholder=""
                                           style="max-width: 70px"
                                           ms-on-keyup="sum($outer.$index,$index,'CHO')"
                                           ms-on-change="sum($outer.$index,$index,'CHO')"
                                           ms-duplex="al.totalCHO"
                                           min="0" onkeyup="minNumber(this)"/>
                                </td>
                                <td>
                                    <input type="number"
                                           ms-attr-id="foodWeightInput_{{$outer.$index}}_{{$index}}_eal"
                                           class="table-input "
                                           placeholder=""
                                           style="max-width: 70px"
                                           ms-on-keyup="sum($outer.$index,$index,'Protein')"
                                           ms-on-change="sum($outer.$index,$index,'Protein')"
                                           ms-duplex="al.totalProtein"
                                           min="0" onkeyup="minNumber(this)"/>
                                </td>
                                <td>
                                    <input type="number"
                                           ms-attr-id="foodWeightInput_{{$outer.$index}}_{{$index}}_eal"
                                           class="table-input "
                                           placeholder=""
                                           style="max-width: 70px"
                                           ms-on-keyup="sum($outer.$index,$index,'Fat')"
                                           ms-on-change="sum($outer.$index,$index,'Fat')"
                                           ms-duplex="al.totalFat"
                                           min="0" onkeyup="minNumber(this)"/>
                                </td>
                                <!--<td>-->
                                    <!--<select name="" class="" ms-duplex="al.MealSign">-->
                                        <!--<option value="1">正餐</option>-->
                                        <!--<option value="2">加餐</option>-->
                                        <!--<option value="3">训练前</option>-->
                                        <!--<option value="4">训练中</option>-->
                                        <!--<option value="5">训练后</option>-->
                                    <!--</select>-->
                                <!--</td>-->
                            </tr>
                            </tbody>
                            <tfoot>
                            <tr>
                                <td>
                                    小计
                                </td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <!--<tr>-->
                                <!--<td>-->
                                    <!--推荐值-->
                                <!--</td>-->
                                <!--<td></td>-->
                                <!--<td></td>-->
                                <!--<td>{{info.mealtotal[$index].goodEnergy}}</td>-->
                                <!--<td>{{info.mealtotal[$index].goodCHO}}</td>-->
                                <!--<td>{{info.mealtotal[$index].goodProtein}}</td>-->
                                <!--<td>{{info.mealtotal[$index].goodFat}}</td>-->
                                <!--<td></td>-->
                            <!--</tr>-->
                            </tfoot>
                        </table>


                    </div>

                </div>
                <!--食谱统计-->
                <div class="hr-panel" style="margin-bottom: 20px">
                    <div class="hr-panel-title">
                        食谱统计
                    </div>
                    <div class="hr-panel-body" style="padding:10px">
                        <table class="table table-responsive table-bordered ">
                            <thead>
                            <tr>
                                <td></td>
                                <td>能量总计(kcal)</td>
                                <td>碳水化合物(g)</td>
                                <td>蛋白质(g)</td>
                                <td>脂肪(g)</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>小计</td>
                                <td>{{dayTotal.dayEnergy}}</td>
                                <td>{{dayTotal.dayCHO}}</td>
                                <td>{{dayTotal.dayProtein}}</td>
                                <td>{{dayTotal.dayFat}}</td>
                            </tr>
                            <!--<tr>-->
                                <!--<td>推荐</td>-->
                                <!--<td>{{dayTotal.dayGoodEnergy}}</td>-->
                                <!--<td>{{dayTotal.dayGoodCHO}}</td>-->
                                <!--<td>{{dayTotal.dayGoodProtein}}</td>-->
                                <!--<td>{{dayTotal.dayGoodFat}}</td>-->
                            <!--</tr>-->
                            </tbody>
                        </table>
                        <br>
                        <div class="row">
                            <div class="col-sm-7">
                                <table class="table table-responsive table-bordered ">
                                    <thead>
                                    <tr>
                                        <td>食物类别</td>
                                        <td>实际摄入量</td>
                                        <td>推荐摄入量</td>

                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ms-repeat="foodTypes">
                                        <td>
                                            <div class="food-type select-food-type pull-left" style="display: block"
                                                 ms-class="food-type-{{el.TypeID}}:el.foodTotal>0"
                                                 ms-class-2="now-food:foodType===el.TypeID"
                                                 ms-class-3="want-food-type:el.wanting"
                                                 ms-click="setFoodType(el.TypeID)">
                                            <span ms-if="el.foodTotal==0">
                                                 {{el.icon}}
                                            </span>

                                            </div>
                                            &nbsp;
                                            {{el.Name}}
                                        </td>
                                        <td ms-class="attention:(el.TargetWeightMin-el.foodTotal)>el.foodTotal/10||(el.foodTotal-el.TargetWeightMax)>el.foodTotal/10">
                                            {{el.foodTotal}}
                                            <span class="text-danger pull-right"
                                                  ms-if="(el.TargetWeightMin-el.foodTotal)>el.foodTotal/10">缺乏</span>
                                            <span class="text-danger pull-right"
                                                  ms-if="(el.foodTotal-el.TargetWeightMax)>el.foodTotal/10">过量</span>
                                        </td>
                                        <td>{{el.TargetWeightMin}}-{{el.TargetWeightMax}}g</td>

                                    </tr>

                                    </tbody>
                                </table>
                            </div>
                            <div class="col-sm-5">
                                <table class="table table-responsive table-bordered ">
                                    <thead>
                                    <tr>
                                        <td>微量元素</td>
                                        <td>实际摄入量</td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ms-repeat="TE">
                                        <td>
                                            {{$val.name}}
                                        </td>
                                        <td>
                                            {{$val.sum}}
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <br/>
                    </div>
                </div>

                <!--食谱简介-->
                <div class="hr-panel" style="margin-bottom: 20px">
                    <div class="hr-panel-title">
                        食谱介绍
                    </div>
                    <div class="hr-panel-body" style="padding: 10px">
                    <textarea rows="5" class="form-control" placeholder="填写食谱介绍"></textarea>
                    </div>
                </div>
            </div>

        </div>
        <div class="row">
            <div class="col-sm-6 pull-right" >
                <!--点击事件-->
                <button class="btn btn-success btn-block">
                    保存
                </button>
            </div>
        </div>
    </div>
</div>
<div style="width: 100%;height: 100px">

</div>
</body>
</html>